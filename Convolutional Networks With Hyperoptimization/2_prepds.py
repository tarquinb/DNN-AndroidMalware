'''
Prepare training and testing sets.
'''

import pandas as pd
import os
from random import sample

DATA_DIR = "DATA"


def main():
    benign_data = pd.read_pickle(os.path.join(DATA_DIR) +
                                 '/benign_data.pickle', compression='gzip')
    malware_data = pd.read_pickle(os.path.join(DATA_DIR) +
                                  '/malware_data.pickle', compression='gzip')

    total_data = benign_data.append(malware_data)

    benign_sel = sample(list(benign_data.index), 1500)
    malware_sel = sample(list(malware_data.index), 1500)

    trn_index = benign_sel + malware_sel

    train_ds = pd.DataFrame(index=trn_index, columns=list(benign_data.columns))
    count_b = 0
    count_m = 0

    for x in benign_sel:
        train_ds.loc[x]['label'] = 'BENIGN'
        train_ds.loc[x]['words'] = benign_data.loc[x]['words']

    for x in malware_sel:
        train_ds.loc[x]['label'] = 'MALWARE'
        train_ds.loc[x]['words'] = malware_data.loc[x]['words']

    train_ds = train_ds.sample(frac=1)
    test_ds = total_data.drop(train_ds.index)

    train_ds.to_pickle(os.path.join(DATA_DIR) + '/train_ds_1500.pickle',
                       compression='gzip', protocol=4)
    test_ds.to_pickle(os.path.join(DATA_DIR) + '/test_ds_1900.pickle',
                      compression='gzip', protocol=4)
    # total_data.to_pickle(os.path.join(DATA_DIR) + '/total_data.pickle',
    #                      compression='gzip', protocol=4)

    for i in total_data.index:
        if total_data.loc[i]['label'] == 'BENIGN':
            count_b += 1
        elif total_data.loc[i]['label'] == 'MALWARE':
            count_m += 1
    print('benign: {} malware: {}'.format(count_b, count_m))

    return 0


if __name__ == '__main__':
    import time
    start_time = time.time()
    main()
    print('Time Taken: {} seconds'.format(time.time() - start_time))
